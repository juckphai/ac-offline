‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1Ô∏è‚É£ ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≤‡∏Å localStorage ‚Üí IndexedDB (Offline-only)
‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ IndexedDB

‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å (‡∏´‡∏•‡∏≤‡∏¢‡∏£‡πâ‡∏≠‡∏¢ MB)

‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ localStorage ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ï

‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Offline 100%

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (1 Database)

Database name

offline_finance_db


Object Stores

settings        ‚Üí accounts, currentAccount, backupPassword
records         ‚Üí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
accountTypes    ‚Üí ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ

1Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡∏Å)

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠

indexeddb.js

‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
const DB_NAME = 'offline_finance_db';
const DB_VERSION = 1;

function openDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onupgradeneeded = (e) => {
            const db = e.target.result;

            if (!db.objectStoreNames.contains('settings')) {
                db.createObjectStore('settings', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('records')) {
                db.createObjectStore('records', { autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('accountTypes')) {
                db.createObjectStore('accountTypes', { keyPath: 'account' });
            }
        };

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

2Ô∏è‚É£ save / load (‡πÅ‡∏ó‡∏ô saveToLocal / loadFromLocal)
üîπ saveToIndexedDB()
async function saveToIndexedDB() {
    const db = await openDB();
    const tx = db.transaction(['settings', 'records', 'accountTypes'], 'readwrite');

    tx.objectStore('settings').put({ key: 'accounts', value: accounts });
    tx.objectStore('settings').put({ key: 'currentAccount', value: currentAccount });
    tx.objectStore('settings').put({ key: 'backupPassword', value: backupPassword });

    const recordStore = tx.objectStore('records');
    recordStore.clear();
    records.forEach(r => recordStore.add(r));

    const typeStore = tx.objectStore('accountTypes');
    typeStore.clear();
    accountTypes.forEach((value, key) => {
        typeStore.put({ account: key, types: value });
    });

    return tx.complete;
}

üîπ loadFromIndexedDB()
async function loadFromIndexedDB() {
    const db = await openDB();

    // settings
    const settingsTx = db.transaction('settings', 'readonly');
    const settingsStore = settingsTx.objectStore('settings');

    accounts = (await settingsStore.get('accounts'))?.value || [];
    currentAccount = (await settingsStore.get('currentAccount'))?.value || null;
    backupPassword = (await settingsStore.get('backupPassword'))?.value || null;

    // records
    records = [];
    await new Promise(resolve => {
        const tx = db.transaction('records', 'readonly');
        tx.objectStore('records').openCursor().onsuccess = e => {
            const cursor = e.target.result;
            if (cursor) {
                records.push(cursor.value);
                cursor.continue();
            } else resolve();
        };
    });

    // accountTypes
    accountTypes = new Map();
    await new Promise(resolve => {
        const tx = db.transaction('accountTypes', 'readonly');
        tx.objectStore('accountTypes').openCursor().onsuccess = e => {
            const cursor = e.target.result;
            if (cursor) {
                accountTypes.set(cursor.value.account, cursor.value.types);
                cursor.continue();
            } else resolve();
        };
    });
}

‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2Ô∏è‚É£ CHECKLIST ‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡∏Ñ‡∏£‡∏ö 100%)
‚úÖ A. ‡∏•‡∏ö Online / Firebase (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥)

 ‡∏•‡∏ö <script firebase*> ‡πÉ‡∏ô HTML

 ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£

currentUser
db
unsubscribeMain
unsubscribeMap


 ‡∏•‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô

saveToFirebase
loadFromFirebase
setupRealtimeListener
deleteRecordRealtime
deleteAccountFromFirebase

‚úÖ B. Authentication

 ‡∏•‡∏ö login overlay HTML

 ‡∏•‡∏ö emailLogin / emailLogout

 ‡πÅ‡∏Å‡πâ helper

function getCurrentUserIdentifier() {
    return 'Local User';
}

‚úÖ C. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢

document.addEventListener('DOMContentLoaded', async () => {
    await loadFromIndexedDB();
    updateAccountSelect();
    changeAccount();
    showToast('üì¥ Offline mode (IndexedDB)', 'info');
});

‚úÖ D. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å saveToLocal()

‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå:

saveToLocal(


‡πÅ‡∏ó‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢:

await saveToIndexedDB();

‚úÖ E. ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
addEntry()

 ‡∏•‡∏ö if (currentUser)

 save ‚Üí IndexedDB ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

deleteRecord()

 ‡∏•‡∏ö realtime delete

 ‡∏•‡∏ö‡∏à‡∏≤‡∏Å array

 save IndexedDB

addAccount / editAccount / deleteAccount

 ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Firebase

 save IndexedDB ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

‚úÖ F. Sync Status

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô

function updateSyncStatus() {
    const el = document.getElementById('sync-status');
    if (!el) return;
    el.textContent = 'üì¥ Offline (IndexedDB)';
    el.style.color = '#777';
}

‚úÖ G. Realtime / Listener

 ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å onSnapshot

 ‡∏•‡∏ö unsubscribe ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

‚úÖ H. Audit Trail

‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°:

createdBy: 'Local User'
editedBy: 'Local User'

‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö

‚úî Offline-only 100%
‚úî ‡πÑ‡∏°‡πà‡∏°‡∏µ Firebase
‚úî ‡πÑ‡∏°‡πà‡∏°‡∏µ Login
‚úî ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢
‚úî ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
‚úî ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å